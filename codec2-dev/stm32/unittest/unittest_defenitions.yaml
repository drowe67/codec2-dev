---

################
# Mod
################

tst_ofdm_mod :
    binary    : tst_ofdm_mod.elf
    input     : ${CODEC2_BIN}/ofdm_get_test_bits stm_in.raw -f 10
    reference : ${CODEC2_BIN}/ofdm_mod stm_in.raw ref_mod_out.raw
    test      : { type : manual }
    check     : ${CODEC2_UTST}/compare_ints -s 2 ref_mod_out.raw mod.raw

################
# Demod
################

tst_ofdm_demod_ideal :
    binary    : tst_ofdm_demod.elf
    input     : 
                - ${CODEC2_BIN}/ofdm_get_test_bits test_bits.raw -f 10
                - ${CODEC2_BIN}/ofdm_mod test_bits.raw stm_in.raw
    reference : ${CODEC2_BIN}/ofdm_demod stm_in.raw ref_demod_out.raw -o ofdm_demod_ref_log.txt --testframes
    test      : { type : manual }
    check     : cmp ref_demod_out.raw stm_out.raw

tst_ofdm_demod_AWGN :
    binary    : tst_ofdm_demod.elf
    input     : 
                - ${CODEC2_BIN}/ofdm_get_test_bits test_bits.raw 10
                - ${CODEC2_BIN}/ofdm_mod test_bits.raw mod_bits.raw
                - ${CODEC2_BIN}/cohpsk_ch mod_bits.raw stm_in.raw -20 -Fs 8000 -f -5 --raw_dir ${CODEC2_BIN}/../../raw
    reference : ${CODEC2_BIN}/ofdm_demod stm_in.raw ref_demod_out.raw -o ofdm_demod_ref_log.txt --testframes
    test      : { type : manual }
    check     : cmp ref_demod_out.raw stm_out.raw

tst_ofdm_demod_fade :
    binary    : tst_ofdm_demod.elf
    input     : 
                - ${CODEC2_BIN}/ofdm_get_test_bits test_bits.raw 60
                - ${CODEC2_BIN}/ofdm_mod test_bits.raw mod_bits.raw
                - ${CODEC2_BIN}/cohpsk_ch mod_bits.raw stm_in.raw -20 -Fs 8000 --fast -f -5 --raw_dir ${CODEC2_BIN}/../../raw
    reference : ${CODEC2_BIN}/ofdm_demod stm_in.raw ref_demod_out.raw -o ofdm_demod_ref_log.txt --testframes
    test      : { type : manual }
    check     : 
                - grep BER prepare_reference_err.log > ref_ber
                - grep BER uut.log > uut_ber
                - diff ref_ber uut_ber

tst_ofdm_demod_profile :
    binary    : tst_ofdm_demod.elf
    input     : 
                - ${CODEC2_BIN}/ofdm_get_test_bits test_bits.raw 10
                - ${CODEC2_BIN}/ofdm_mod test_bits.raw mod_bits.raw
                - ${CODEC2_BIN}/cohpsk_ch mod_bits.raw stm_in.raw -20 -Fs 8000 --fast -f -5 --raw_dir ${CODEC2_BIN}/../../raw
    reference : ${CODEC2_BIN}/ofdm_demod stm_in.raw ref_demod_out.raw -o ofdm_demod_ref_log.txt --testframes
    test      : { type : manual }
    check     : 
                - grep 'ofdm_demod_' uut.log > uut_profile.log
                - ${UTST_BIN}/sum_profiles uut_profile.log

...
# vi:set ts=4 et sts=4:
